# Предсказание цен на автомобили и сервис на FastAPI для этого
В данном репозитории есть ноутбук с исследованиями по прогнозированию цен на машины:
1. Есть EDA для датасета.
2. Предобработка фичей.
3. Поиск наилучшей модели и feature engineering.

Также тут есть два .py файлика: в одном все, что нужно для препроцессинга модели, во втором простенький сервис для прогнозирования новых машин.

Лучший вариант модели хранится в формате `pickle` файла - `model.pkl`. Это моделька, которую можно прочитать с помощью `joblib.load(file)`. 

# Описание лучшей модели

В качестве модели была взята `Ridge` регрессия, которая в первом приближении была сразу обучения на датасете категориальных фичей из прошлых пунктов и с логарифмированным таргетом. Такой бейзлайн сразу дал +20% у метрики r2 и неплохой буст в MSE. Так что идея с логарифмированием таргета мастхев. 

Дальше я попытался доработать фичи модели, согласно EDA, и вот что удалось:
* отношение max_power к engine;
* нормализация пробега машин;
* фича состояния автомобиля по количеству владельцев;
* полиномы фичей 2 степени;
* заэнкоженные бренды машин из name;
* все остальные категориальные фичи.

Все числовые фичи были заскейлены при помощи `StandardScaler`. Для избежания мультиколлинеарности при создании категорийных фичей стоял флаг `drop_first=True`. 

Модель обучалась на 10 фолдах, в грид серче подобрался параметр `alpha` = 0.1. 

Что не получилось:
* нормально преобразовать фичу `torque`, очень кривые данные, как по мне;
* фича mileage/year не дала буст в качестве;
* не стал чистить данные от выбросов в фичах и таргете, так как это не давало особо буста в качестве;
* добавление полиномов 3 степени.

# Метрики

У получившейся модели:
* `MSE` = 47794623046.065
* `R2` = 0.91
* Доля предсказаний с отклонением от реального таргета в 10%: 0.375

Причем значение `R2` равно 0.91 как на трейне, так и на тесте.

# Что дало больший буст

1. Преобразование таргета (логарифмирование) - так как распределение привелось чуть к более нормальному;
2. Фича max_power/emgine - так как у них была высокая корреляция;
3. Полиномы вещественных фичей.

# Пример работы сервиса 

Записал примерный скринкаст работы сервиса: https://disk.yandex.ru/i/xdGs-iBFR87Rvw
У сервиса всего 2 ручки - можно подать `json` с одной машиной и получить число как ответ, или подать `.csv` файл и получить `.csv` как ответ.